### Draft Final Project Report


## Introduction
Implementing a subsytem of the bigger sensory stone project. 

## Application description
### Features
- Crude Gesture recogntion to change modes
- **Breathing Mode:** The user lies with the device on there chest and slows there breathing to the required rate for the required time to make the LEDS glow ( [inspriation from](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3203837/#:~:text=Accelerometers%20have%20been%20increasingly%20used,using%20digital%20signal%20processing%20technology.))
- **Colour Mode:** The movements of the stone in XYZ from the accelerometer change RGB, respectively.
  - accelerometer double-tap stores the color 
  - double tap again, resets
- Timer based Sleep Mode ( implement low power mode ), if there are no user interactions. 
- Save user settings to non-volatile memory
- Data logging of movement to USB mass storage ( as proof of concept ), data manipulation to save files nicely for use later.
- implement cli
  - pass test data to the cli
  - mimic commands that would be replicated over ble
  - log activity/session data
  - set activity  state table
  - test peripherals
  - save  input data to mass storage
  - Load Led patterns 
  - set user preferences ( like choosing the color of the light in breathing mode )
  

  
## Hardware Description
#### BOM
- ST32429I-disc main board
- 5v external power source ( I am using this )
- Power bank to power the board.
- 8 wsb32i addressabel LEDS
- LIS3DH 3axis accelerometor
- Bread board
- FAT fromatted USB stick
- Breadboard 
- Various plastic bits to build enclosure 
- Hot glue ( always hot glue ) 
- various jumper wires. 
[ Hardware block diagram ]
[ Hardware connection schematic ]
[images of Build]

## Software Description
Describe the code in general

○ Describe the parts you wrote in some detail (maybe 3-5 sentences per module)
### Main
### Session Controller 
### Gyroscope control 
### Acellerometor Control 
### Gesture decoder 
### Sleep 
### Breathing 
### Console 
### USB Controller 
### Util 
### User


## Code used from 

Gyroscope calibrartion and data access: https://github.dev/adem-alnajjar/Gyroscope-L3GD20-_STM32/.   
Console code from homework: https://wokwi.com/projects/324879108372693587.   
Code generated by CubeIDE: ST Cmsis and HAL.   
WS2812B  driver using STM32 HAL, Timer PWM and DMA ported to the class board: https://github.com/hey-frnk/STM32_HAL_NeoPixel   
Crude gesture recognition:    
 - https://learn.adafruit.com/magic-wand?view=all.   
 - 

## Licenses
### ST - HAL

HALs are distributed under the 3-clause BSD license, and that means you are free to do pretty much anything with them as long as you propagate the copyright and don't use ST and contributors' names for commercial endorsement or promotion.
https://opensource.org/licenses/BSD-3-Clause

### ARM - csmis
As advertised on arm's website, all CMSIS SW components are under the business-friendly Apache 2.0 license. It is a bit less permissive than BSD, and you should for example pay attention to the clauses regarding redistribution as they are a bit more developed (for example item #4).

http://arm-software.github.io/CMSIS_5/General/html/index.html#License

### Port of VFD collective code fot neopizels on stm32
https://www.thevfdcollective.com/ They have a Open Source statment but no refrence to an actual licence. This may be problematic in the future because there is no specific licencse. 

Trying to avoid creative commons share alike. 

## Build Instructions

### Software
Install CubeIDE
○ How you debugged and tested the system
○ How you powered it (and how you might in the future)

### Hardware



○ How you debugged and tested the system
Use Multimeter to insure power is getting to the right places. 



## MVP

### Using only only on boad peripherals instead of additional ones. 
  - LED screen for visual out put 
  - Gyroscope only 
  - USB for storage/data logging 
 
 ### Implement simple gestures for the mode selection only using gyroscope:
   - x full twist for Breathing  mode
   - y full twist for Colour response mode
  
  ### Mode simplification 
  - **Breathing Mode**
   -   use timer to change colour of Led with arrow to indicate inwards breath and outwards breaths.
  
  - **Color Mode**
    - X rotation changes R value
    - Y rotation changes G value
    - Z rotation changes B value
  
  ### Button press to enter CLI mode
  ### State Machine for General Mode management and for the Modes them selves.
  ### USB mass storage 


## Pitfalls / Blocking 
### Software:
Working with the IDE

### Hardware:
Getting additional parts ( external power supply for the neopixels. ) 
ABlity to actually wire the system with my limited hardware experince ( quality of soldering ) 

## Tasks
### Getting Data out of the sensors
  - [ ] Gyroscope 
  - [ ] Accelerometor ( needs to be hooked up as an external sensor ) 

### Getting data out to the Neopixels 
Timer configured in PWM output mode, that gets it data from a DMA buffer
  -https://www.thevfdcollective.com/blog/stm32-and-sk6812-rgbw-led
  
### Command line implemtation 
- [x] Use homework code as a frame work to implement UART via the  ST-Link virtual com port to computer terminal.
- [ ] Implement additional commands 
  - [ ]   
### Button interuppt 


Input Related 
- [x] Earth (Orbit/Moon)
- [x] Mars
- [ ] Jupiter
- [ ] Saturn
- [ ] Uranus
- [ ] Neptune
- [ ] Comet Haley

## Extension 
○ What would be needed to get this project ready for production?
○ How would you extend this project to do something more? Are there other
features you’d like? How would you go about adding them?
- firmware update
- Low power 
- Implementing the Edge Impulse gesture recognition



## Project requirement checklist
- 3 perpherials: _PWM LEDS, accelerometor on I2C, gyroscope on SPI , USB_
- Button that causes an interrupt: _User button switches to CLI mode_
- Cortex-M processor: _STM32F429ZIT6 on the STM32f429i-disc_
- Implement Serail output: _CLI_
- Implement State Machine: _Implicit in overall implementation and in the different modes_
- Algorithmic piece that makes the system interesting: 
  -  _Resperation detection and  interpretation for the breathing training_ 
  -  _The interpretation of movement data into hue and brightness change_ 


